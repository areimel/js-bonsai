<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UI Controls Test - JS Bonsai</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #2d2d2d;
            border-left: 3px solid #4e9a06;
        }
        .pass { color: #4e9a06; }
        .fail { color: #f44336; }
        pre {
            background: #1e1e1e;
            padding: 10px;
            overflow-x: auto;
            font-size: 12px;
        }
        .option-controls {
            background: #2d2d2d;
            padding: 15px;
            margin: 20px 0;
            border: 1px solid #4e9a06;
        }
        .option-group {
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .option-group label {
            margin-right: 10px;
        }
        .option-group input, .option-group button {
            padding: 5px;
            background: #1e1e1e;
            color: #d4d4d4;
            border: 1px solid #4e9a06;
        }
    </style>
</head>
<body>
    <h1>UI Controls Test</h1>
    <div id="results"></div>

    <h2>Live UI Preview</h2>
    <div class="option-controls"></div>

    <script type="module">
        import CONFIG from './src/config/index.js';
        import { UIControls } from './src/modules/ui-controls.js';

        const results = document.getElementById('results');
        let passCount = 0;
        let failCount = 0;
        let callbackLog = [];

        function test(name, condition, details = '') {
            const section = document.createElement('div');
            section.className = 'test-section';

            const status = condition ? '✓ PASS' : '✗ FAIL';
            const statusClass = condition ? 'pass' : 'fail';

            section.innerHTML = `
                <strong class="${statusClass}">${status}</strong> ${name}
                ${details ? `<pre>${details}</pre>` : ''}
            `;

            results.appendChild(section);

            if (condition) {
                passCount++;
            } else {
                failCount++;
            }
        }

        // Create mock options
        const mockOptions = { ...CONFIG.defaults };

        // Create mock callbacks
        const mockCallbacks = {
            onReset: () => { callbackLog.push('onReset'); console.log('onReset called'); },
            onClearTimeouts: () => { callbackLog.push('onClearTimeouts'); console.log('onClearTimeouts called'); },
            onStart: () => { callbackLog.push('onStart'); console.log('onStart called'); }
        };

        // Test 1: UIControls instance created
        const uiControls = new UIControls(mockOptions, mockCallbacks);
        test('UIControls instance created', uiControls instanceof UIControls);

        // Test 2: createUI creates controls
        uiControls.createUI();
        const optionsContainer = document.querySelector('.option-controls');
        test(
            'createUI populates option-controls container',
            optionsContainer && optionsContainer.children.length > 0,
            `Child elements created: ${optionsContainer?.children.length}`
        );

        // Test 3: Checkbox inputs created
        const checkboxes = optionsContainer.querySelectorAll('input[type="checkbox"]');
        test(
            'Checkbox inputs created',
            checkboxes.length >= 3,
            `Checkboxes found: ${checkboxes.length} (live, infinite, screensaver)`
        );

        // Test 4: Number inputs created
        const numberInputs = optionsContainer.querySelectorAll('input[type="number"]');
        test(
            'Number inputs created',
            numberInputs.length >= 5,
            `Number inputs found: ${numberInputs.length} (time, wait, multiplier, life, seed)`
        );

        // Test 5: Text inputs created
        const textInputs = optionsContainer.querySelectorAll('input[type="text"]');
        test(
            'Text inputs created',
            textInputs.length >= 1,
            `Text inputs found: ${textInputs.length} (message)`
        );

        // Test 6: Generate button created
        const button = optionsContainer.querySelector('button');
        test(
            'Generate button created',
            button && button.textContent.includes('Generate'),
            `Button text: "${button?.textContent}"`
        );

        // Test 7: Checkbox reflects initial value
        const liveCheckbox = document.getElementById('option-live');
        test(
            'Live checkbox reflects initial value from options',
            liveCheckbox && liveCheckbox.checked === mockOptions.live,
            `Checkbox checked: ${liveCheckbox?.checked}, Options value: ${mockOptions.live}`
        );

        // Test 8: Number input reflects initial value
        const lifeInput = document.getElementById('option-life');
        test(
            'Life number input reflects initial value',
            lifeInput && parseInt(lifeInput.value) === mockOptions.life,
            `Input value: ${lifeInput?.value}, Options value: ${mockOptions.life}`
        );

        // Test 9: Text input reflects initial value
        const messageInput = document.getElementById('option-message');
        test(
            'Message text input reflects initial value',
            messageInput && messageInput.value === mockOptions.message,
            `Input value: "${messageInput?.value}", Options value: "${mockOptions.message}"`
        );

        // Test 10: Checkbox change updates options
        const infiniteCheckbox = document.getElementById('option-infinite');
        const originalInfiniteValue = mockOptions.infinite;
        infiniteCheckbox.checked = !originalInfiniteValue;
        infiniteCheckbox.dispatchEvent(new Event('change'));
        test(
            'Checkbox change updates options object',
            mockOptions.infinite === !originalInfiniteValue,
            `Original: ${originalInfiniteValue}, New: ${mockOptions.infinite}`
        );

        // Test 11: Number input change updates options
        const multiplierInput = document.getElementById('option-multiplier');
        multiplierInput.value = 10;
        multiplierInput.dispatchEvent(new Event('change'));
        test(
            'Number input change updates options',
            mockOptions.multiplier === 10,
            `Options multiplier: ${mockOptions.multiplier}`
        );

        // Test 12: Text input change updates options
        messageInput.value = 'Test message';
        messageInput.dispatchEvent(new Event('change'));
        test(
            'Text input change updates options',
            mockOptions.message === 'Test message',
            `Options message: "${mockOptions.message}"`
        );

        // Test 13: Button click triggers callbacks
        callbackLog = [];
        button.click();
        test(
            'Generate button click triggers all callbacks',
            callbackLog.length === 3 &&
            callbackLog[0] === 'onClearTimeouts' &&
            callbackLog[1] === 'onReset' &&
            callbackLog[2] === 'onStart',
            `Callbacks called: [${callbackLog.join(', ')}]`
        );

        // Test 14: Multiple createUI calls clear previous UI
        uiControls.createUI();
        const secondCallChildren = optionsContainer.children.length;
        uiControls.createUI();
        const thirdCallChildren = optionsContainer.children.length;
        test(
            'Multiple createUI calls don\'t duplicate controls',
            secondCallChildren === thirdCallChildren,
            `Children count stays same: ${thirdCallChildren}`
        );

        // Summary
        const summary = document.createElement('div');
        summary.className = 'test-section';
        summary.style.borderLeft = failCount === 0 ? '3px solid #4e9a06' : '3px solid #f44336';
        summary.innerHTML = `
            <h2>Summary</h2>
            <p class="pass">Passed: ${passCount}</p>
            <p class="fail">Failed: ${failCount}</p>
            <p><strong class="${failCount === 0 ? 'pass' : 'fail'}">${failCount === 0 ? '✓ ALL TESTS PASSED' : '✗ SOME TESTS FAILED'}</strong></p>
        `;
        results.appendChild(summary);

        // Log to console
        console.log(`UI Controls Test Results: ${passCount} passed, ${failCount} failed`);
        console.log('UIControls:', uiControls);
    </script>
</body>
</html>
