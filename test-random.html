<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Module Test - JS Bonsai</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #2d2d2d;
            border-left: 3px solid #4e9a06;
        }
        .pass { color: #4e9a06; }
        .fail { color: #f44336; }
        pre {
            background: #1e1e1e;
            padding: 10px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>Random Module Test</h1>
    <div id="results"></div>

    <script type="module">
        import { seedrandom, initializeRandomSeed, getRandom } from './src/utils/random.js';

        const results = document.getElementById('results');
        let passCount = 0;
        let failCount = 0;

        function test(name, condition, details = '') {
            const section = document.createElement('div');
            section.className = 'test-section';

            const status = condition ? '✓ PASS' : '✗ FAIL';
            const statusClass = condition ? 'pass' : 'fail';

            section.innerHTML = `
                <strong class="${statusClass}">${status}</strong> ${name}
                ${details ? `<pre>${details}</pre>` : ''}
            `;

            results.appendChild(section);

            if (condition) {
                passCount++;
            } else {
                failCount++;
            }
        }

        // Test 1: seedrandom function exists
        test('seedrandom function exists', typeof seedrandom === 'function');

        // Test 2: seedrandom returns a function
        const gen = seedrandom(12345);
        test('seedrandom returns a function', typeof gen === 'function');

        // Test 3: Generator produces deterministic values
        const gen1 = seedrandom(12345);
        const gen2 = seedrandom(12345);
        const val1 = gen1();
        const val2 = gen2();
        test(
            'Same seed produces same first value',
            val1 === val2,
            `gen1: ${val1}\ngen2: ${val2}`
        );

        // Test 4: Generator produces different values for different seeds
        const genA = seedrandom(111);
        const genB = seedrandom(222);
        const valA = genA();
        const valB = genB();
        test(
            'Different seeds produce different values',
            valA !== valB,
            `seed 111: ${valA}\nseed 222: ${valB}`
        );

        // Test 5: Generate sequence and verify consistency
        const gen3 = seedrandom(12345);
        const gen4 = seedrandom(12345);
        const sequence1 = [];
        const sequence2 = [];

        for (let i = 0; i < 100; i++) {
            sequence1.push(gen3());
            sequence2.push(gen4());
        }

        const allMatch = sequence1.every((val, i) => val === sequence2[i]);
        test(
            'Same seed produces identical 100-value sequence',
            allMatch,
            `First 5 values:\nseq1: [${sequence1.slice(0, 5).map(v => v.toFixed(6)).join(', ')}]\nseq2: [${sequence2.slice(0, 5).map(v => v.toFixed(6)).join(', ')}]`
        );

        // Test 6: initializeRandomSeed function exists
        test('initializeRandomSeed function exists', typeof initializeRandomSeed === 'function');

        // Test 7: initializeRandomSeed sets seed if null
        const options = { seed: null, verbose: false };
        initializeRandomSeed(options);
        test(
            'initializeRandomSeed generates seed when null',
            options.seed !== null && typeof options.seed === 'number',
            `Generated seed: ${options.seed}`
        );

        // Test 8: getRandom function exists
        test('getRandom function exists', typeof getRandom === 'function');

        // Test 9: getRandom produces deterministic values
        const opt1 = { seed: 42, verbose: false };
        const opt2 = { seed: 42, verbose: false };

        initializeRandomSeed(opt1);
        const vals1 = [];
        for (let i = 0; i < 10; i++) {
            vals1.push(getRandom());
        }

        initializeRandomSeed(opt2);
        const vals2 = [];
        for (let i = 0; i < 10; i++) {
            vals2.push(getRandom());
        }

        const randAllMatch = vals1.every((val, i) => val === vals2[i]);
        test(
            'getRandom produces identical sequence for same seed',
            randAllMatch,
            `seed 42, first 5 values:\n[${vals1.slice(0, 5).map(v => v.toFixed(6)).join(', ')}]\n[${vals2.slice(0, 5).map(v => v.toFixed(6)).join(', ')}]`
        );

        // Test 10: Large sequence test (1000 values)
        const opt3 = { seed: 12345, verbose: false };
        const opt4 = { seed: 12345, verbose: false };

        initializeRandomSeed(opt3);
        const largeSeq1 = [];
        for (let i = 0; i < 1000; i++) {
            largeSeq1.push(getRandom());
        }

        initializeRandomSeed(opt4);
        const largeSeq2 = [];
        for (let i = 0; i < 1000; i++) {
            largeSeq2.push(getRandom());
        }

        const largeMatch = largeSeq1.every((val, i) => val === largeSeq2[i]);
        test(
            '1000-value sequence is identical for seed 12345',
            largeMatch,
            `All 1000 values match: ${largeMatch}\nLast 5 values:\n[${largeSeq1.slice(-5).map(v => v.toFixed(6)).join(', ')}]`
        );

        // Test 11: Values are between 0 and 1
        const opt5 = { seed: 9999, verbose: false };
        initializeRandomSeed(opt5);
        const testVals = [];
        for (let i = 0; i < 100; i++) {
            testVals.push(getRandom());
        }
        const allInRange = testVals.every(v => v >= 0 && v <= 1);
        test(
            'All values are between 0 and 1',
            allInRange,
            `min: ${Math.min(...testVals).toFixed(6)}\nmax: ${Math.max(...testVals).toFixed(6)}`
        );

        // Summary
        const summary = document.createElement('div');
        summary.className = 'test-section';
        summary.style.borderLeft = failCount === 0 ? '3px solid #4e9a06' : '3px solid #f44336';
        summary.innerHTML = `
            <h2>Summary</h2>
            <p class="pass">Passed: ${passCount}</p>
            <p class="fail">Failed: ${failCount}</p>
            <p><strong class="${failCount === 0 ? 'pass' : 'fail'}">${failCount === 0 ? '✓ ALL TESTS PASSED' : '✗ SOME TESTS FAILED'}</strong></p>
        `;
        results.appendChild(summary);

        // Log to console
        console.log(`Random Module Test Results: ${passCount} passed, ${failCount} failed`);
    </script>
</body>
</html>
